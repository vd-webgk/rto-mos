function bx_sale_gift_product_load(t,e,s){e=e||{},s=s||{},BX.ajax({url:"/bitrix/components/bitrix/sale.gift.product/ajax.php",method:"POST",data:BX.merge(e,s),dataType:"html",processData:!1,start:!0,onsuccess:function(e){var s=BX.processHTML(e);BX(t).innerHTML=s.HTML,BX.ajax.processScripts(s.SCRIPT),initCountdown()}})}!function(t){if(t.JCCatalogSectionOnlyElement||(t.JCCatalogSectionOnlyElement=function(t){"object"==typeof t&&(this.params=t,this.obProduct=null,this.set_quantity=1,this.currentPriceMode="",this.currentPrices=[],this.currentPriceSelected=0,this.currentQuantityRanges=[],this.currentQuantityRangeSelected=0,this.params.MESS&&(this.mess=this.params.MESS),this.init())},t.JCCatalogSectionOnlyElement.prototype={init:function(){this.obProduct=BX(this.params.ID),this.obProduct&&($(this.obProduct).find(".counter_wrapp .counter_block input").data("product","ob"+this.obProduct.id+"el"),this.currentPriceMode=this.params.ITEM_PRICE_MODE,this.currentPrices=this.params.ITEM_PRICES,this.currentQuantityRanges=this.params.ITEM_QUANTITY_RANGES)},setPriceAction:function(){this.set_quantity=this.params.MIN_QUANTITY_BUY,$(this.obProduct).find("input[name=quantity]").length&&(this.set_quantity=$(this.obProduct).find("input[name=quantity]").val()),this.checkPriceRange(this.set_quantity),$(this.obProduct).find(".not_matrix").hide(),$(this.obProduct).find(".with_matrix .price_value_block").html(this.currentPrices[this.currentPriceSelected].PRINT_PRICE),$(this.obProduct).find(".with_matrix .discount")&&$(this.obProduct).find(".with_matrix .discount").html(this.currentPrices[this.currentPriceSelected].PRINT_BASE_PRICE),$(this.obProduct).find(".with_matrix .sale_block .text .values_wrapper").html(this.currentPrices[this.currentPriceSelected].PRINT_DISCOUNT),$(this.obProduct).find(".with_matrix .sale_block .value span").html(this.currentPrices[this.currentPriceSelected].PERCENT),$(this.obProduct).find(".with_matrix").show(),"Y"==arOptimusOptions.THEME.SHOW_TOTAL_SUMM&&setPriceItem($(this.obProduct),this.set_quantity,this.currentPrices[this.currentPriceSelected].PRICE)},checkPriceRange:function(t){if("undefined"!=typeof t&&"Q"==this.currentPriceMode){var e,s=!1;for(var i in this.currentQuantityRanges)if(this.currentQuantityRanges.hasOwnProperty(i)&&(e=this.currentQuantityRanges[i],parseInt(t)>=parseInt(e.SORT_FROM)&&("INF"==e.SORT_TO||parseInt(t)<=parseInt(e.SORT_TO)))){s=!0,this.currentQuantityRangeSelected=e.HASH;break}!s&&(e=this.getMinPriceRange())&&(this.currentQuantityRangeSelected=e.HASH);for(var o in this.currentPrices)if(this.currentPrices.hasOwnProperty(o)&&this.currentPrices[o].QUANTITY_HASH==this.currentQuantityRangeSelected){this.currentPriceSelected=o;break}}},getMinPriceRange:function(){var t;for(var e in this.currentQuantityRanges)this.currentQuantityRanges.hasOwnProperty(e)&&(!t||parseInt(this.currentQuantityRanges[e].SORT_FROM)<parseInt(t.SORT_FROM))&&(t=this.currentQuantityRanges[e]);return t}}),!t.JCSaleGiftProduct){var e=function(t){e.superclass.constructor.apply(this,arguments),this.nameNode=BX.create("span",{props:{className:"bx_medium bx_bt_button",id:this.id},text:t.text}),this.buttonNode=BX.create("span",{attrs:{className:t.ownerClass},style:{marginBottom:"0",borderBottom:"0 none transparent"},children:[this.nameNode],events:this.contextEvents}),BX.browser.IsIE()&&this.buttonNode.setAttribute("hideFocus","hidefocus")};BX.extend(e,BX.PopupWindowButton),t.JCSaleGiftProduct=function(t){if(this.skuVisualParams={SELECT:{TAG_BIND:"select",TAG:"option",ACTIVE_CLASS:"active",HIDE_CLASS:"hidden",EVENT:"change"},LI:{TAG_BIND:"li",TAG:"li",ACTIVE_CLASS:"active",HIDE_CLASS:"missing",EVENT:"click"}},this.productType=0,this.showQuantity=!0,this.showAbsent=!0,this.secondPict=!1,this.showOldPrice=!1,this.showPercent=!1,this.showSkuProps=!1,this.visual={ID:"",PICT_ID:"",SECOND_PICT_ID:"",QUANTITY_ID:"",QUANTITY_UP_ID:"",QUANTITY_DOWN_ID:"",PRICE_ID:"",DSC_PERC:"",SECOND_DSC_PERC:"",DISPLAY_PROP_DIV:"",BASKET_PROP_DIV:""},this.product={checkQuantity:!1,maxQuantity:0,stepQuantity:1,isDblQuantity:!1,canBuy:!0,canSubscription:!0,name:"",pict:{},id:0,addUrl:"",buyUrl:""},this.basketData={useProps:!1,emptyProps:!1,quantity:"quantity",props:"prop",basketUrl:""},this.defaultPict={pict:null,secondPict:null},this.checkQuantity=!1,this.maxQuantity=0,this.stepQuantity=1,this.isDblQuantity=!1,this.canBuy=!0,this.canSubscription=!0,this.precision=6,this.precisionFactor=Math.pow(10,this.precision),this.currentPriceMode="",this.currentPrices=[],this.currentPriceSelected=0,this.currentQuantityRanges=[],this.currentQuantityRangeSelected=0,this.offers=[],this.offerNum=0,this.treeProps=[],this.obTreeRows=[],this.showCount=[],this.showStart=[],this.selectedValues={},this.obProduct=null,this.obQuantity=null,this.obQuantityUp=null,this.obQuantityDown=null,this.obPict=null,this.obSecondPict=null,this.obPrice=null,this.obTree=null,this.obBuyBtn=null,this.obDscPerc=null,this.obSecondDscPerc=null,this.obSkuProps=null,this.obMeasure=null,this.obPopupWin=null,this.basketUrl="",this.basketParams={},this.treeRowShowSize=5,this.treeEnableArrow={display:"",cursor:"pointer",opacity:1},this.treeDisableArrow={display:"",cursor:"default",opacity:.2},this.lastElement=!1,this.containerHeight=0,this.errorCode=0,"object"==typeof t){switch(this.productType=parseInt(t.PRODUCT_TYPE,10),this.showQuantity=t.SHOW_QUANTITY,this.showAbsent=t.SHOW_ABSENT,this.secondPict=!!t.SECOND_PICT,this.showOldPrice=!!t.SHOW_OLD_PRICE,this.showPercent=!!t.SHOW_DISCOUNT_PERCENT,this.showSkuProps=!!t.SHOW_SKU_PROPS,this.visual=t.VISUAL,this.productType){case 1:case 2:t.PRODUCT&&"object"==typeof t.PRODUCT?(this.showQuantity&&(this.product.checkQuantity=t.PRODUCT.CHECK_QUANTITY,this.product.isDblQuantity=t.PRODUCT.QUANTITY_FLOAT,this.product.checkQuantity&&(this.product.maxQuantity=this.product.isDblQuantity?parseFloat(t.PRODUCT.MAX_QUANTITY):parseInt(t.PRODUCT.MAX_QUANTITY,10)),this.product.stepQuantity=this.product.isDblQuantity?parseFloat(t.PRODUCT.STEP_QUANTITY):parseInt(t.PRODUCT.STEP_QUANTITY,10),this.checkQuantity=this.product.checkQuantity,this.isDblQuantity=this.product.isDblQuantity,this.maxQuantity=this.product.maxQuantity,this.stepQuantity=this.product.stepQuantity,this.isDblQuantity&&(this.stepQuantity=Math.round(this.stepQuantity*this.precisionFactor)/this.precisionFactor)),this.product.canBuy=t.PRODUCT.CAN_BUY,this.product.canSubscription=t.PRODUCT.SUBSCRIPTION,this.canBuy=this.product.canBuy,this.canSubscription=this.product.canSubscription,this.product.name=t.PRODUCT.NAME,this.product.pict=t.PRODUCT.PICT,this.product.id=t.PRODUCT.ID,t.PRODUCT.ADD_URL&&(this.product.addUrl=t.PRODUCT.ADD_URL),t.PRODUCT.BUY_URL&&(this.product.buyUrl=t.PRODUCT.BUY_URL),t.BASKET&&"object"==typeof t.BASKET&&(this.basketData.useProps=!!t.BASKET.ADD_PROPS,this.basketData.emptyProps=!!t.BASKET.EMPTY_PROPS)):this.errorCode=-1;break;case 3:t.OFFERS&&BX.type.isArray(t.OFFERS)?(t.PRODUCT&&"object"==typeof t.PRODUCT&&(this.product.name=t.PRODUCT.NAME,this.product.id=t.PRODUCT.ID),this.offers=t.OFFERS,this.offerNum=0,t.OFFER_SELECTED&&(this.offerNum=parseInt(t.OFFER_SELECTED,10)),isNaN(this.offerNum)&&(this.offerNum=0),t.TREE_PROPS&&(this.treeProps=t.TREE_PROPS),t.DEFAULT_PICTURE&&(this.defaultPict.pict=t.DEFAULT_PICTURE.PICTURE,this.defaultPict.secondPict=t.DEFAULT_PICTURE.PICTURE_SECOND)):this.errorCode=-1;break;default:this.errorCode=-1}t.BASKET&&"object"==typeof t.BASKET&&(t.BASKET.QUANTITY&&(this.basketData.quantity=t.BASKET.QUANTITY),t.BASKET.PROPS&&(this.basketData.props=t.BASKET.PROPS),t.BASKET.BASKET_URL&&(this.basketData.basketUrl=t.BASKET.BASKET_URL)),this.lastElement=!!t.LAST_ELEMENT&&"Y"===t.LAST_ELEMENT}0===this.errorCode&&BX.ready(BX.delegate(this.Init,this))},t.JCSaleGiftProduct.prototype.Init=function(){var t=0,e="",s=null;if(this.obProduct=BX(this.visual.ID),this.obProduct||(this.errorCode=-1),this.obPict=BX(this.visual.PICT_ID),this.obPict||(this.errorCode=-2),this.secondPict&&this.visual.SECOND_PICT_ID&&(this.obSecondPict=BX(this.visual.SECOND_PICT_ID)),this.storeQuanity=BX(this.visual.STORE_QUANTITY),this.obPrice=BX(this.visual.PRICE_ID),this.obPriceOld=BX(this.visual.PRICE_OLD_ID),this.obPrice||(this.errorCode=-16),this.showQuantity&&this.visual.QUANTITY_ID&&(this.obQuantity=BX(this.visual.QUANTITY_ID),this.visual.QUANTITY_UP_ID&&(this.obQuantityUp=BX(this.visual.QUANTITY_UP_ID)),this.visual.QUANTITY_DOWN_ID&&(this.obQuantityDown=BX(this.visual.QUANTITY_DOWN_ID))),3===this.productType){if(this.visual.TREE_ID)for(this.obTree=BX(this.visual.TREE_ID),this.obTree||(this.errorCode=-256),e=this.visual.TREE_ITEM_ID,t=0;t<this.treeProps.length;t++)if(this.obTreeRows[t]={LIST:BX(e+this.treeProps[t].ID+"_list"),CONT:BX(e+this.treeProps[t].ID+"_cont")},!this.obTreeRows[t].LIST||!this.obTreeRows[t].CONT){this.errorCode=-512;break}this.visual.QUANTITY_MEASURE&&(this.obMeasure=BX(this.visual.QUANTITY_MEASURE))}if(this.visual.BUY_ID&&(this.obBuyBtn=BX(this.visual.BUY_ID)),this.showPercent&&(this.visual.DSC_PERC&&(this.obDscPerc=BX(this.visual.DSC_PERC)),this.secondPict&&this.visual.SECOND_DSC_PERC&&(this.obSecondDscPerc=BX(this.visual.SECOND_DSC_PERC))),this.showSkuProps&&this.visual.DISPLAY_PROP_DIV&&(this.obSkuProps=BX(this.visual.DISPLAY_PROP_DIV)),0===this.errorCode){switch(this.showQuantity&&(this.obQuantityUp&&BX.bind(this.obQuantityUp,"click",BX.delegate(this.QuantityUp,this)),this.obQuantityDown&&BX.bind(this.obQuantityDown,"click",BX.delegate(this.QuantityDown,this)),this.obQuantity&&BX.bind(this.obQuantity,"change",BX.delegate(this.QuantityChange,this))),this.productType){case 1:break;case 3:for(var i in this.skuVisualParams){var s=BX.findChildren(this.obTree,{tagName:this.skuVisualParams[i].TAG_BIND},!0);if(s&&0<s.length)for(t=0;t<s.length;t++)$(s[t]).on(this.skuVisualParams[i].EVENT,BX.delegate(this.SelectOfferProp,this))}this.SetCurrent()}this.obBuyBtn&&BX.bind(this.obBuyBtn,"click",BX.delegate(this.Basket,this))}},t.JCSaleGiftProduct.prototype.checkHeight=function(){this.containerHeight=parseInt(this.obProduct.parentNode.offsetHeight,10),isNaN(this.containerHeight)&&(this.containerHeight=0)},t.JCSaleGiftProduct.prototype.setHeight=function(){0<this.containerHeight&&BX.adjust(this.obProduct.parentNode,{style:{height:this.containerHeight+"px"}})},t.JCSaleGiftProduct.prototype.clearHeight=function(){BX.adjust(this.obProduct.parentNode,{style:{height:"auto"}})},t.JCSaleGiftProduct.prototype.QuantityUp=function(){var t=0,e=!0;0===this.errorCode&&this.showQuantity&&this.canBuy&&(t=this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10),isNaN(t)||(t+=this.stepQuantity,this.checkQuantity&&t>this.maxQuantity&&(e=!1),e&&(this.isDblQuantity&&(t=Math.round(t*this.precisionFactor)/this.precisionFactor),this.obQuantity.value=t)))},t.JCSaleGiftProduct.prototype.QuantityDown=function(){var t=0,e=!0;0===this.errorCode&&this.showQuantity&&this.canBuy&&(t=this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10),isNaN(t)||(t-=this.stepQuantity,t<this.stepQuantity&&(e=!1),e&&(this.isDblQuantity&&(t=Math.round(t*this.precisionFactor)/this.precisionFactor),this.obQuantity.value=t)))},t.JCSaleGiftProduct.prototype.QuantityChange=function(){var t=0,e=!0;0===this.errorCode&&this.showQuantity&&(this.canBuy?(t=this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10),isNaN(t)?this.obQuantity.value=this.stepQuantity:(this.checkQuantity&&(t>this.maxQuantity?(e=!1,t=this.maxQuantity):t<this.stepQuantity&&(e=!1,t=this.stepQuantity)),e||(this.obQuantity.value=t))):this.obQuantity.value=this.stepQuantity)},t.JCSaleGiftProduct.prototype.QuantitySet=function(t){0===this.errorCode&&(this.canBuy=this.offers[t].CAN_BUY,this.currentPriceMode=this.offers[t].ITEM_PRICE_MODE,this.currentPrices=this.offers[t].ITEM_PRICES,this.currentPriceSelected=this.offers[t].ITEM_PRICE_SELECTED,this.currentQuantityRanges=this.offers[t].ITEM_QUANTITY_RANGES,this.currentQuantityRangeSelected=this.offers[t].ITEM_QUANTITY_RANGE_SELECTED,this.canBuy?(this.obBasketActions&&BX.style(this.obBasketActions,"display",""),this.obNotAvail&&BX.style(this.obNotAvail,"display","none")):(this.obBasketActions&&(BX.style(this.obBasketActions,"opacity","0"),BX.style(BX.findParent(BX(this.obQuantity),{"class":"counter_block"}),"display","none")),this.obNotAvail&&BX.style(this.obNotAvail,"display","")),this.showQuantity&&(this.isDblQuantity=this.offers[t].QUANTITY_FLOAT,this.checkQuantity=this.offers[t].CHECK_QUANTITY,this.isDblQuantity?(this.maxQuantity=parseFloat(this.offers[t].MAX_QUANTITY),this.stepQuantity=Math.round(parseFloat(this.offers[t].STEP_QUANTITY)*this.precisionFactor)/this.precisionFactor):(this.maxQuantity=parseInt(this.offers[t].MAX_QUANTITY,10),this.stepQuantity=parseInt(this.offers[t].STEP_QUANTITY,10)),this.obQuantity&&(this.obQuantity.value=this.defaultCount,this.obQuantity.disabled=!this.canBuy),this.obMeasure&&(this.offers[t].MEASURE?BX.adjust(this.obMeasure,{html:this.offers[t].MEASURE}):BX.adjust(this.obMeasure,{html:""}))),this.currentBasisPrice=this.offers[t].BASIS_PRICE)},t.JCSaleGiftProduct.prototype.SelectOfferProp=function(){var t=0,e="",s="",i=[],o=null,r=BX.proxy_context;if(r&&r.hasAttribute("data-treevalue")&&(s=r.getAttribute("data-treevalue"),propModes=r.getAttribute("data-showtype"),i=s.split("_"),this.SearchOfferPropIndex(i[0],i[1])&&(o=BX.findChildren(r.parentNode,{tagName:this.skuVisualParams[propModes.toUpperCase()].TAG},!1),o&&0<o.length)))for(t=0;t<o.length;t++)e=o[t].getAttribute("data-onevalue"),"TEXT"==propModes?e===i[1]?o[t].setAttribute("selected","selected"):o[t].removeAttribute("selected"):e===i[1]?$(o[t]).addClass(this.skuVisualParams[propModes.toUpperCase()].ACTIVE_CLASS):$(o[t]).removeClass(this.skuVisualParams[propModes.toUpperCase()].ACTIVE_CLASS)},t.JCSaleGiftProduct.prototype.SearchOfferPropIndex=function(t,e){var s,i,o="",r=!1,a=[],n=-1,h={},u=[];for(s=0;s<this.treeProps.length;s++)if(this.treeProps[s].ID===t){n=s;break}if(n>-1){for(s=0;n>s;s++)o="PROP_"+this.treeProps[s].ID,h[o]=this.selectedValues[o];if(o="PROP_"+this.treeProps[n].ID,r=this.GetRowValues(h,o),!r)return!1;if(!BX.util.in_array(e,r))return!1;for(h[o]=e,s=n+1;s<this.treeProps.length;s++){if(o="PROP_"+this.treeProps[s].ID,r=this.GetRowValues(h,o),!r)return!1;if(this.showAbsent)for(a=[],u=[],u=BX.clone(h,!0),i=0;i<r.length;i++)u[o]=r[i],this.GetCanBuy(u)&&(a[a.length]=r[i]);else a=r;this.selectedValues[o]&&BX.util.in_array(this.selectedValues[o],a)?h[o]=this.selectedValues[o]:h[o]=a[0],this.UpdateRow(s,h[o],r,a)}this.selectedValues=h,this.ChangeInfo()}return!0},t.JCSaleGiftProduct.prototype.RowLeft=function(){var t=0,e="",s=-1,i=BX.proxy_context;if(i&&i.hasAttribute("data-treevalue")){for(e=i.getAttribute("data-treevalue"),t=0;t<this.treeProps.length;t++)if(this.treeProps[t].ID===e){s=t;break}s>-1&&this.treeRowShowSize<this.showCount[s]&&(0>this.showStart[s]&&(this.showStart[s]++,BX.adjust(this.obTreeRows[s].LIST,{style:{marginLeft:20*this.showStart[s]+"%"}}),BX.adjust(this.obTreeRows[s].RIGHT,{style:this.treeEnableArrow})),0<=this.showStart[s]&&BX.adjust(this.obTreeRows[s].LEFT,{style:this.treeDisableArrow}))}},t.JCSaleGiftProduct.prototype.RowRight=function(){var t=0,e="",s=-1,i=BX.proxy_context;if(i&&i.hasAttribute("data-treevalue")){for(e=i.getAttribute("data-treevalue"),t=0;t<this.treeProps.length;t++)if(this.treeProps[t].ID===e){s=t;break}s>-1&&this.treeRowShowSize<this.showCount[s]&&(this.treeRowShowSize-this.showStart[s]<this.showCount[s]&&(this.showStart[s]--,BX.adjust(this.obTreeRows[s].LIST,{style:{marginLeft:20*this.showStart[s]+"%"}}),BX.adjust(this.obTreeRows[s].LEFT,{style:this.treeEnableArrow})),this.treeRowShowSize-this.showStart[s]>=this.showCount[s]&&BX.adjust(this.obTreeRows[s].RIGHT,{style:this.treeDisableArrow}))}},t.JCSaleGiftProduct.prototype.UpdateRow=function(t,e,s,i){var o=0,r=0,a="",n=0,h={},u=!1,c=0,l=(this.treeEnableArrow,this.treeEnableArrow,0),p=null;if(t>-1&&t<this.obTreeRows.length&&(propMode=this.treeProps[t].DISPLAY_TYPE,p=BX.findChildren(this.obTreeRows[t].LIST,{tagName:this.skuVisualParams[propMode].TAG},!1),p&&0<p.length)){for(selectMode="SELECT"===this.treeProps[t].DISPLAY_TYPE,n=s.length,h={style:{},props:{disabled:"",selected:""}},o=0;o<p.length;o++)a=p[o].getAttribute("data-onevalue"),u=a===e&&0!=a,BX.util.in_array(a,i)?h.props.className=u?this.skuVisualParams[propMode].ACTIVE_CLASS:"":h.props.className=u?this.skuVisualParams[propMode].ACTIVE_CLASS+" "+this.skuVisualParams[propMode].HIDE_CLASS:this.skuVisualParams[propMode].HIDE_CLASS,selectMode?(h.props.disabled="disabled",h.props.selected=u?"selected":""):h.style.display="none",BX.util.in_array(a,s)&&(selectMode?h.props.disabled="":h.style.display="",u&&(c=r),r++),BX.adjust(p[o],h);selectMode&&$(this.obTreeRows[t].LIST).parent().hasClass("ik_select")&&$(this.obTreeRows[t].LIST).ikSelect("reset"),this.showCount[t]=n,this.showStart[t]=l}},t.JCSaleGiftProduct.prototype.GetRowValues=function(t,e){var s,i=0,o=[],r=!1,a=!0;if(0===t.length){for(i=0;i<this.offers.length;i++)BX.util.in_array(this.offers[i].TREE[e],o)||(o[o.length]=this.offers[i].TREE[e]);r=!0}else for(i=0;i<this.offers.length;i++){a=!0;for(s in t)if(t[s]!==this.offers[i].TREE[s]){a=!1;break}a&&(BX.util.in_array(this.offers[i].TREE[e],o)||(o[o.length]=this.offers[i].TREE[e]),r=!0)}return r?o:!1},t.JCSaleGiftProduct.prototype.GetCanBuy=function(t){var e,s=0,i=!1,o=!0;for(s=0;s<this.offers.length;s++){o=!0;for(e in t)if(t[e]!==this.offers[s].TREE[e]){o=!1;break}if(o&&this.offers[s].CAN_BUY){i=!0;break}}return i},t.JCSaleGiftProduct.prototype.SetCurrent=function(){var t=0,e=0,s=[],i="",o=!1,r={},a=[],n=this.offers[this.offerNum].TREE;for(t=0;t<this.treeProps.length&&(i="PROP_"+this.treeProps[t].ID,o=this.GetRowValues(r,i),o);t++){if(BX.util.in_array(n[i],o)?r[i]=n[i]:(r[i]=o[0],this.offerNum=0),this.showAbsent)for(s=[],a=[],a=BX.clone(r,!0),e=0;e<o.length;e++)a[i]=o[e],this.GetCanBuy(a)&&(s[s.length]=o[e]);else s=o;this.UpdateRow(t,r[i],o,s)}this.selectedValues=r,this.ChangeInfo()},t.JCSaleGiftProduct.prototype.ChangeInfo=function(){var e,s=0,i=-1,o={},r=!0;for(s=0;s<this.offers.length;s++){r=!0;for(e in this.selectedValues)if(this.selectedValues[e]!==this.offers[s].TREE[e]){r=!1;break}if(r){i=s;break}}if(i>-1){if(this.obPict){var o={attrs:{}};this.offers[i].PREVIEW_PICTURE?o.attrs.src=this.offers[i].PREVIEW_PICTURE.SRC:o.attrs.src=this.defaultPict.pict.SRC,BX.adjust(BX.findChild(this.obPict,{tag:"img"}),o)}this.showSkuProps&&this.obSkuProps&&(0===this.offers[i].DISPLAY_PROPERTIES.length?BX.adjust(this.obSkuProps,{style:{display:"none"},html:""}):BX.adjust(this.obSkuProps,{style:{display:""},html:this.offers[i].DISPLAY_PROPERTIES})),this.setQuantityStore(this.offers[i].MAX_QUANTITY,this.offers[i].AVAILIABLE.TEXT),this.offerNum=i,this.QuantitySet(this.offerNum),$(this.obProduct).find(".quantity_block .values").length&&$(this.obProduct).find(".quantity_block .values .item span").text(this.offers[i].MAX_QUANTITY).css({opacity:"1"}),"Y"==this.offers[i].SHOW_DISCOUNT_TIME_EACH_SKU&&initCountdownTime($(this.obProduct),this.offers[i].DISCOUNT_ACTIVE);var a=this.offers[i],n=$(this.obProduct),h=this;"undefined"!=typeof arBasketAspro?this.setActualDataBlock(n,a):"undefined"!=typeof t.frameCacheVars&&BX.addCustomEvent("onFrameDataReceived",function(){h.setActualDataBlock(n,a)})}},t.JCSaleGiftProduct.prototype.setActualDataBlock=function(t,e){this.setLikeBlock(t,".like_icons .wish_item_button",e,"DELAY"),this.setLikeBlock(t,".like_icons .compare_item_button",e,"COMPARE"),this.setBuyBlock(t,e)},t.JCSaleGiftProduct.prototype.setLikeBlock=function(t,e,s,i){var o=t;"DELAY"==i&&(s.CAN_BUY?o.find(e).css("display","block"):o.find(e).hide()),o.find(e).attr("data-item",s.ID),o.find(e).find("span").attr("data-item",s.ID),arBasketAspro[i]&&(o.find(e).find(".to").removeClass("added").css("display","block"),o.find(e).find(".in").hide(),void 0!==arBasketAspro[i][s.ID]&&(o.find(e).find(".to").hide(),o.find(e).find(".in").css("display","block")))},t.JCSaleGiftProduct.prototype.setBuyBlock=function(t,e){var s=t.find(".offer_buy_block"),i=e.CONFIG.MIN_QUANTITY_BUY;if(s.find(".counter_wrapp .counter_block").length&&s.find(".counter_wrapp .counter_block").attr("data-item",e.ID),this.offers[this.offerNum].offer_set_quantity&&(i=this.offers[this.offerNum].offer_set_quantity),e.CONFIG.OPTIONS.USE_PRODUCT_QUANTITY_DETAIL&&"ADD"==e.CONFIG.ACTION&&e.CAN_BUY){var o=e.CONFIG.MAX_QUANTITY_BUY>0?"data-max='"+e.CONFIG.MAX_QUANTITY_BUY+"'":"",r='<span class="minus">-</span><input type="text" class="text" name="'+e.PRODUCT_QUANTITY_VARIABLE+'" value="'+i+'" /><span class="plus" '+o+">+</span>";arBasketAspro.BASKET&&void 0!==arBasketAspro.BASKET[e.ID]?s.find(".counter_wrapp .counter_block").length?s.find(".counter_wrapp .counter_block").hide():(s.find(".counter_wrapp").prepend('<div class="counter_block" data-item="'+e.ID+'"></div>'),s.find(".counter_wrapp .counter_block").html(r).hide()):s.find(".counter_wrapp .counter_block").length?s.find(".counter_wrapp .counter_block").html(r).show():(s.find(".counter_wrapp").prepend('<div class="counter_block" data-item="'+e.ID+'"></div>'),s.find(".counter_wrapp .counter_block").html(r))}else s.find(".counter_wrapp .counter_block").length&&s.find(".counter_wrapp .counter_block").hide();var a="ORDER"==e.CONFIG.ACTION||!e.CAN_BUY||!e.CONFIG.OPTIONS.USE_PRODUCT_QUANTITY_DETAIL||"SUBSCRIBE"==e.CONFIG.ACTION&&"Y"==e.CATALOG_SUBSCRIBE?"wide":"";$('<div class="button_block"></div>');if(s.find(".counter_wrapp").find(".button_block").length?arBasketAspro.BASKET&&void 0!==arBasketAspro.BASKET[e.ID]?(s.find(".counter_wrapp").find(".button_block").addClass("wide").html(e.HTML),markProductAddBasket(e.ID)):a?(s.find(".counter_wrapp").find(".button_block").addClass("wide").html(e.HTML),arBasketAspro.SUBSCRIBE&&void 0!==arBasketAspro.SUBSCRIBE[e.ID]&&markProductSubscribe(e.ID)):s.find(".counter_wrapp").find(".button_block").removeClass("wide").html(e.HTML):(s.find(".counter_wrapp").append('<div class="button_block '+a+'">'+e.HTML+"</div>"),arBasketAspro.BASKET&&void 0!==arBasketAspro.BASKET[e.ID]&&markProductAddBasket(e.ID),arBasketAspro.SUBSCRIBE&&void 0!==arBasketAspro.SUBSCRIBE[e.ID]&&markProductSubscribe(e.ID)),"NOTHING"!==e.CONFIG.ACTION)if("ADD"==e.CONFIG.ACTION&&e.CAN_BUY&&"N"!=e.SHOW_ONE_CLICK_BUY){var n='<span class="transparent big_btn type_block button one_click" data-offers="Y" data-item="'+e.ID+'" data-iblockID="'+e.IBLOCK_ID+'" data-quantity="'+e.CONFIG.MIN_QUANTITY_BUY+'" data-props="'+e.OFFER_PROPS+'" onclick="oneClickBuy('+e.ID+", "+e.IBLOCK_ID+', this)"><span>'+e.ONE_CLICK_BUY+"</span></span>";s.find(".wrapp_one_click").length?s.find(".wrapp_one_click").html(n):s.append('<div class="wrapp_one_click">'+n+"</div>")}else s.find(".wrapp_one_click").length&&s.find(".wrapp_one_click").remove();else s.find(".wrapp_one_click").length&&s.find(".wrapp_one_click").remove();s.fadeIn(),s.find(".counter_wrapp .counter_block input").data("product","ob"+this.obProduct.id);var h=e.MEASURE&&"Y"==e.SHOW_MEASURE?e.MEASURE:"";"PRICE"in e&&this.setPrice("","Y",e.PRICES,h,t,e)},t.JCSaleGiftProduct.prototype.setPrice=function(t,e,s,i,o,r){var a;if(this.obPrice){var i=this.offers[this.offerNum].MEASURE&&"Y"==this.offers[this.offerNum].SHOW_MEASURE?this.offers[this.offerNum].MEASURE:"",o=$(this.obProduct),n=this.offers[this.offerNum].PRICE,h="",u="undefined"!=typeof e&&"Y"==e;if(this.offers[this.offerNum].offer_set_quantity=this.offers[this.offerNum].CONFIG.MIN_QUANTITY_BUY,$(o).find("input[name=quantity]").length&&(this.offers[this.offerNum].offer_set_quantity=$(o).find("input[name=quantity]").val()),a='<span class="values_wrapper">'+getCurrentPrice(n.VALUE,n.CURRENCY,n.PRINT_VALUE)+"</span>",i&&(a=a+"/"+i),BX.adjust(this.obPrice,{html:a}),n.DISCOUNT_VALUE!==n.VALUE&&this.showOldPrice&&n.DISCOUNT_VALUE>0?(price_value=BX.Currency.currencyFormat(n.VALUE*this.offers[this.offerNum].offer_set_quantity,n.CURRENCY),price_value_old=BX.Currency.currencyFormat(n.VALUE,n.CURRENCY),$(this.obPriceOld).find("strike").show().html('<span class="values_wrapper">'+n.PRINT_VALUE.replace(price_value_old,price_value)+"</span>"),this.showPercent&&($(this.obPriceOld).closest(".cost").find(".sale_block").show(),$(this.obPriceOld).closest(".cost").find(".value").html(n.DISCOUNT_DIFF_PERCENT_RAW),$(this.obPriceOld).closest(".cost").find(".text span").html(BX.Currency.currencyFormat(n.DISCOUNT_DIFF,n.CURRENCY,!0)))):($(this.obPriceOld).find("strike").hide().html(""),this.showPercent&&$(this.obPriceOld).closest(".cost").find(".sale_block").hide()),"Y"==arOptimusOptions.THEME.SHOW_TOTAL_SUMM){if(this.offers[this.offerNum].check_quantity)h="Y";else{var h="undefined"!=typeof t&&"Y"==t?t:"";h&&(this.offers[this.offerNum].check_quantity=!0)}setPriceItem(o,this.offers[this.offerNum].offer_set_quantity,"",h,u)}var c={product:o,measure:i,config:this.config,offer:this.offers[this.offerNum],obPrice:n};BX.onCustomEvent("onAsproSkuSetPrice",[c])}},t.JCSaleGiftProduct.prototype.setQuantityStore=function(t,e){parseFloat(t)>0?$(this.storeQuanity).find(".icon").removeClass("order").addClass("stock"):$(this.storeQuanity).find(".icon").removeClass("stock").addClass("order"),$(this.storeQuanity).find(".icon + span").html(e)},t.JCSaleGiftProduct.prototype.InitBasketUrl=function(){switch(this.productType){case 1:case 2:this.basketUrl=this.product.addUrl;break;case 3:this.basketUrl=this.offers[this.offerNum].ADD_URL}this.basketParams={ajax_basket:"Y"},this.showQuantity&&(this.basketParams[this.basketData.quantity]=this.obQuantity.value)},t.JCSaleGiftProduct.prototype.FillBasketProps=function(){if(this.visual.BASKET_PROP_DIV){var t=0,e=null,s=!1,i=null;if(this.basketData.useProps&&!this.basketData.emptyProps?this.obPopupWin&&this.obPopupWin.contentContainer&&(i=this.obPopupWin.contentContainer):i=BX(this.visual.BASKET_PROP_DIV),i){if(e=i.getElementsByTagName("select"),e&&e.length)for(t=0;t<e.length;t++)if(!e[t].disabled)switch(e[t].type.toLowerCase()){case"select-one":this.basketParams[e[t].name]=e[t].value,s=!0}if(e=i.getElementsByTagName("input"),e&&e.length)for(t=0;t<e.length;t++)if(!e[t].disabled)switch(e[t].type.toLowerCase()){case"hidden":this.basketParams[e[t].name]=e[t].value,s=!0;break;case"radio":e[t].checked&&(this.basketParams[e[t].name]=e[t].value,s=!0)}s||(this.basketParams[this.basketData.props]=[],this.basketParams[this.basketData.props][0]=0)}}},t.JCSaleGiftProduct.prototype.SendToBasket=function(){this.canBuy&&(this.InitBasketUrl(),this.FillBasketProps(),BX.ajax.loadJSON(this.basketUrl,this.basketParams,BX.delegate(this.BasketResult,this)))},t.JCSaleGiftProduct.prototype.Basket=function(){var t="";if(this.canBuy)switch(this.productType){case 1:case 2:this.basketData.useProps&&!this.basketData.emptyProps?(this.InitPopupWindow(),this.obPopupWin.setTitleBar({content:BX.create("div",{style:{marginRight:"30px",whiteSpace:"nowrap"},text:BX.message("CVP_TITLE_BASKET_PROPS")})}),BX(this.visual.BASKET_PROP_DIV)&&(t=BX(this.visual.BASKET_PROP_DIV).innerHTML),this.obPopupWin.setContent(t),this.obPopupWin.setButtons([new e({ownerClass:this.obProduct.parentNode.parentNode.parentNode.className,text:BX.message("CVP_BTN_MESSAGE_SEND_PROPS"),events:{click:BX.delegate(this.SendToBasket,this)}})]),this.obPopupWin.show()):this.SendToBasket();break;case 3:this.SendToBasket()}},t.JCSaleGiftProduct.prototype.BasketResult=function(t){var s="",i="",o="",r=!0,a=[];if(this.obPopupWin&&this.obPopupWin.close(),"object"!=typeof t)return!1;if(r="OK"===t.STATUS){switch(BX.onCustomEvent("OnBasketChange"),i=this.product.name,this.productType){case 1:case 2:o=this.product.pict.SRC;break;case 3:o=this.offers[this.offerNum].PREVIEW_PICTURE?this.offers[this.offerNum].PREVIEW_PICTURE.SRC:this.defaultPict.pict.SRC}s='<div style="width: 96%; margin: 10px 2%; text-align: center;"><img src="'+o+'" height="130" style="max-height:130px"><p>'+i+"</p></div>",a=[new e({ownerClass:this.obProduct.parentNode.parentNode.parentNode.className,text:BX.message("CVP_BTN_MESSAGE_BASKET_REDIRECT"),events:{click:BX.delegate(function(){location.href=this.basketData.basketUrl?this.basketData.basketUrl:BX.message("CVP_BASKET_URL")},this)}})]}else s=t.MESSAGE?t.MESSAGE:BX.message("CVP_BASKET_UNKNOWN_ERROR"),a=[new e({ownerClass:this.obProduct.parentNode.parentNode.parentNode.className,text:BX.message("CVP_BTN_MESSAGE_CLOSE"),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})];this.InitPopupWindow(),this.obPopupWin.setTitleBar({content:BX.create("div",{style:{marginRight:"30px",whiteSpace:"nowrap"},text:r?BX.message("CVP_TITLE_SUCCESSFUL"):BX.message("CVP_TITLE_ERROR")})}),this.obPopupWin.setContent(s),this.obPopupWin.setButtons(a),this.obPopupWin.show()},t.JCSaleGiftProduct.prototype.InitPopupWindow=function(){this.obPopupWin||(this.obPopupWin=BX.PopupWindowManager.create("CatalogSectionBasket_"+this.visual.ID,null,{autoHide:!1,offsetLeft:0,offsetTop:0,overlay:!0,closeByEsc:!0,titleBar:!0,closeIcon:{top:"10px",right:"10px"}}))}}}(window);